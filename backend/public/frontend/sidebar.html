<!-- Desktop Sidebar -->
<div class="hidden md:flex w-72 min-w-64 h-screen flex-col shadow-2xl overflow-hidden" ng-controller="SidebarController" style="background: linear-gradient(135deg, #232526 0%, #414345 100%);">
  <div class="px-6 py-3 flex items-center bg-gray-900 border-b border-gray-700 shadow-md">
    <div class="flex items-center justify-center w-12 h-12 bg-transparent mr-4">
      <i class="fab fa-whatsapp text-3xl text-green-400"></i>
    </div>
    <h1 class="text-2xl font-bold tracking-wide text-white">WhatsPro</h1>
  </div>

  <nav class="flex-1 overflow-y-auto py-4 relative" id="desktop-nav">
    <a href="#/dashboard" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/dashboard'), 'text-gray-300': !isActive('/dashboard')}">
      <i class="fas fa-tachometer-alt w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Dashboard</span>
    </a>
    <a href="#/groups" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/groups'), 'text-gray-300': !isActive('/groups')}">
      <i class="fas fa-users w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Groups</span>
    </a>
    <a href="#/events" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/events'), 'text-gray-300': !isActive('/events')}">
      <i class="fas fa-calendar-alt w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Events</span>
    </a>
    <a href="#/event-reminders" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/event-reminders'), 'text-gray-300': !isActive('/event-reminders')}">
      <i class="fas fa-bell w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Event Reminders</span>
    </a>
    <a href="#/schedules" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/schedules'), 'text-gray-300': !isActive('/schedules')}">
      <i class="far fa-clock w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Group Schedules</span>
    </a>
    <a href="#/direct-schedule" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/direct-schedule'), 'text-gray-300': !isActive('/direct-schedule')}">
      <i class="fas fa-paper-plane w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Message Schedule</span>
    </a>
    <a href="#/sequences" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/sequences'), 'text-gray-300': !isActive('/sequences')}">
      <i class="fas fa-bullhorn w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Drip Campaigns</span>
    </a>
    <a href="#/media" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/media'), 'text-gray-300': !isActive('/media')}">
      <i class="far fa-image w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Media Library</span>
    </a>
    <a href="#/users" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/users'), 'text-gray-300': !isActive('/users')}" ng-if="user.role === 'admin'">
      <i class="fas fa-user-shield w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Users</span>
    </a>
    <a href="#/status" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/status'), 'text-gray-300': !isActive('/status')}">
      <i class="fas fa-hourglass-half w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Status</span>
    </a>
    <a href="#/settings" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300" ng-class="{'bg-green-600/30 text-green-300': isActive('/settings'), 'text-gray-300': !isActive('/settings')}">
      <i class="fas fa-cog w-7 text-center text-lg group-hover:text-green-400 transition"></i>
      <span class="font-medium">Settings</span>
    </a>
  </nav>

  <!-- Scroll indicator for desktop - positioned outside nav to stay fixed -->
  <div class="absolute bottom-16 right-6 z-10 hidden md:block cursor-pointer" id="desktop-scroll-indicator" style="display: none;">
    <div class="pointer-events-auto bg-gray-800/70 rounded-full p-3 hover:bg-gray-700/80 transition-all duration-200 shadow-lg" ng-click="toggleScroll('desktop-nav')" title="Click to scroll">
      <i class="fas text-green-400 text-sm" ng-class="desktopScrollDirection === 'down' ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
    </div>
  </div>

  <div class="px-6 py-4 border-t border-gray-700 bg-gray-900/60 shadow-inner flex-shrink-0" style="min-height: 80px;">
    <!-- Loading state -->
    <div ng-if="loadingUser" class="flex items-center space-x-2 mb-2">
      <div class="w-4 h-4 rounded-full border-2 border-green-400 border-t-transparent animate-spin"></div>
      <span class="text-sm text-gray-300">Loading...</span>
    </div>
    <!-- Error state -->
    <p ng-if="userError" class="text-sm text-red-400 mb-2">
      <i class="fas fa-exclamation-circle mr-1"></i> 
      Error loading user
    </p>
    <!-- User info when available -->
    <div ng-if="!loadingUser && !userError && user.username" class="flex items-center justify-between mb-2 p-2 rounded bg-gray-800/80 shadow" style="min-height:44px;">
      <div class="flex items-center">
        <i class="fas fa-user-circle text-lg text-green-400"></i>
        <span class="font-semibold text-green-300 text-sm ml-2">{{user.username | uppercase}}</span>
      </div>
      <div class="flex items-center space-x-2">
        <!-- Force refresh button for mobile cache issues -->
        <button ng-click="forceRefresh()"
                ng-disabled="refreshing"
                class="bg-transparent text-green-400 hover:text-green-600 p-2 rounded-full focus:outline-none min-w-[36px] min-h-[36px] flex items-center justify-center md:hidden"
                title="Force Refresh App">
          <i class="fas fa-sync-alt text-sm" ng-if="!refreshing"></i>
          <i class="fas fa-spinner fa-spin text-sm" ng-if="refreshing"></i>
        </button>
        <!-- Logout button -->
        <button ng-click="logout()"
                ng-disabled="loggingOut"
                class="bg-transparent text-green-400 hover:text-green-600 p-2 rounded-full focus:outline-none min-w-[40px] min-h-[40px] flex items-center justify-center"
                title="Logout">
          <i class="fas fa-sign-out-alt text-lg" ng-if="!loggingOut"></i>
          <i class="fas fa-spinner fa-spin text-lg" ng-if="loggingOut"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Mobile Sidebar -->
<div ng-controller="SidebarController"></div>
  <button aria-label="Open sidebar" class="md:hidden fixed top-4 left-4 z-50 p-2 rounded-lg bg-gray-900/80 text-green-400 shadow-lg focus:outline-none focus:ring-2 focus:ring-green-400" ng-click="openSidebar()" type="button">
    <i class="fas fa-bars text-2xl"></i>
  </button>
  <div ng-show="sidebarOpen" class="fixed inset-0 z-40 bg-black/40 md:hidden transition-opacity duration-200" ng-click="closeSidebar()" aria-hidden="true"></div>
  <div class="w-72 h-screen flex flex-col shadow-2xl overflow-hidden fixed z-50 top-0 left-0 bg-gradient-to-br from-[#232526] to-[#414345] transition-transform duration-300 md:hidden mobile-sidebar-container" ng-class="{'-translate-x-full': !sidebarOpen, 'translate-x-0': sidebarOpen}" style="background: linear-gradient(135deg, #232526 0%, #414345 100%);" tabindex="-1" aria-label="Sidebar navigation" ng-show="sidebarOpen">
    <button ng-click="closeSidebar()" aria-label="Close sidebar" class="absolute top-4 right-4 z-50 p-2 rounded-lg bg-gray-900/80 text-green-400 shadow-lg focus:outline-none focus:ring-2 focus:ring-green-400">
      <i class="fas fa-times text-2xl"></i>
    </button>
        <div class="px-6 py-3 flex items-center bg-gray-900 border-b border-gray-700 shadow-md">
      <div class="flex items-center justify-center w-12 h-12 bg-transparent mr-4">
        <i class="fab fa-whatsapp text-3xl text-green-400"></i>
      </div>
      <h1 class="text-2xl font-bold tracking-wide text-white">WhatsPro</h1>
    </div>
    <nav class="flex-1 overflow-y-auto py-4 relative" id="mobile-nav">
      <a href="#/dashboard" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/dashboard'), 'text-gray-300': !isActive('/dashboard')}">
        <i class="fas fa-tachometer-alt w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Dashboard</span>
      </a>
      <a href="#/groups" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/groups'), 'text-gray-300': !isActive('/groups')}">
        <i class="fas fa-users w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Groups</span>
      </a>
      <a href="#/events" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/events'), 'text-gray-300': !isActive('/events')}">
        <i class="fas fa-calendar-alt w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Events</span>
      </a>
      <a href="#/event-reminders" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/event-reminders'), 'text-gray-300': !isActive('/event-reminders')}">
        <i class="fas fa-bell w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Event Reminders</span>
      </a>
      <a href="#/schedules" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/schedules'), 'text-gray-300': !isActive('/schedules')}">
        <i class="far fa-clock w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Group Schedules</span>
      </a>
      <a href="#/direct-schedule" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/direct-schedule'), 'text-gray-300': !isActive('/direct-schedule')}">
        <i class="fas fa-paper-plane w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Message Schedule</span>
      </a>
      <a href="#/sequences" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/sequences'), 'text-gray-300': !isActive('/sequences')}">
        <i class="fas fa-bullhorn w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Drip Campaigns</span>
      </a>
      <a href="#/media" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/media'), 'text-gray-300': !isActive('/media')}">
        <i class="far fa-image w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Media Library</span>
      </a>
      <a href="#/users" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/users'), 'text-gray-300': !isActive('/users')}" ng-if="user.role === 'admin'">
        <i class="fas fa-user-shield w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Users</span>
      </a>
      <a href="#/status" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/status'), 'text-gray-300': !isActive('/status')}">
        <i class="fas fa-hourglass-half w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Status</span>
      </a>
      <a href="#/settings" class="group flex items-center gap-3 px-6 py-3 my-1 rounded-xl transition-all duration-200 hover:bg-green-500/20 hover:text-green-300 mobile-nav-link" ng-class="{'bg-green-600/30 text-green-300': isActive('/settings'), 'text-gray-300': !isActive('/settings')}">
        <i class="fas fa-cog w-7 text-center text-lg group-hover:text-green-400 transition"></i>
        <span class="font-medium">Settings</span>
      </a>
    </nav>

  <!-- Scroll indicator for mobile - positioned outside nav to stay fixed -->
  <div class="absolute bottom-28 right-4 z-10 md:hidden cursor-pointer" id="mobile-scroll-indicator" style="display: none;">
    <div class="pointer-events-auto bg-gray-800/70 rounded-full p-3 hover:bg-gray-700/80 transition-all duration-200 shadow-lg" ng-click="toggleScroll('mobile-nav')" title="Click to scroll">
      <i class="fas text-green-400 text-sm" ng-class="mobileScrollDirection === 'down' ? 'fa-chevron-down' : 'fa-chevron-up'"></i>
    </div>
  </div>

    <div class="px-6 py-3 border-t border-gray-700 bg-gray-900/60 shadow-inner flex-shrink-0" style="border-color: #75ff71; min-height: 80px;">
      <!-- Loading state -->
      <div ng-if="loadingUser" class="flex items-center space-x-2 mb-2">
        <div class="w-4 h-4 rounded-full border-2 border-green-400 border-t-transparent animate-spin"></div>
        <span class="text-sm text-gray-300">Loading...</span>
      </div>
      <!-- Error state -->
      <p ng-if="userError" class="text-sm text-red-400 mb-2">
        <i class="fas fa-exclamation-circle mr-1"></i> 
        Error loading user
      </p>
      <!-- User info when available -->
      <div ng-if="!loadingUser && !userError && user.username" class="flex items-center justify-between mb-2 p-2 rounded bg-gray-800/80 shadow" style="min-height:44px;">
        <div class="flex items-center">
          <i class="fas fa-user-circle text-lg text-green-400"></i>
          <span class="font-semibold text-green-300 text-sm ml-2">{{user.username | uppercase}}</span>
        </div>
        <div class="flex items-center space-x-2">
          <!-- Force refresh button for mobile cache issues -->
          <button ng-click="forceRefresh()"
                  ng-disabled="refreshing"
                  class="bg-transparent text-green-400 hover:text-green-600 p-2 rounded-full focus:outline-none min-w-[36px] min-h-[36px] flex items-center justify-center"
                  title="Force Refresh App">
            <i class="fas fa-sync-alt text-sm" ng-if="!refreshing"></i>
            <i class="fas fa-spinner fa-spin text-sm" ng-if="refreshing"></i>
          </button>
          <!-- Logout button -->
          <button ng-click="logout()"
                  ng-disabled="loggingOut"
                  class="bg-transparent text-green-400 hover:text-green-600 p-2 rounded-full focus:outline-none min-w-[40px] min-h-[40px] flex items-center justify-center"
                  title="Logout">
            <i class="fas fa-sign-out-alt text-lg" ng-if="!loggingOut"></i>
            <i class="fas fa-spinner fa-spin text-lg" ng-if="loggingOut"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  @media (max-width: 767px) {
    .min-w-64 { min-width: 0 !important; }
    .sidebar-logout-btn {
      font-size: 1.2rem !important;
      min-height: 56px !important;
      margin-bottom: 16px !important;
    }
    /* Ensure mobile sidebar takes full height */
    .mobile-sidebar-container {
      height: 100vh !important;
      max-height: 100vh !important;
    }
    /* Better mobile touch targets */
    .mobile-nav-link {
      min-height: 48px !important;
    }
  }
  
  /* Scroll indicator animations */
  @keyframes fadeInOut {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }
  
  .scroll-indicator {
    animation: fadeInOut 2s infinite;
    transition: all 0.3s ease;
  }
  
  .scroll-indicator:hover {
    opacity: 1 !important;
    transform: translateY(-2px);
  }
  
  .scroll-indicator:hover .fas {
    transform: scale(1.2);
    color: #22c55e !important;
  }
  
  /* Better positioning for scroll indicators */
  #desktop-scroll-indicator,
  #mobile-scroll-indicator {
    z-index: 30 !important;
    pointer-events: auto;
  }
  
  #desktop-scroll-indicator i,
  #mobile-scroll-indicator i {
    animation: blink 1.5s infinite;
  }
  
  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0.3; }
  }
</style>

<script>
angular.module('autopostWaApp.core').filter('capitalize', function() {
  return function(input) {
    if (!input) return '';
    return input.charAt(0).toUpperCase() + input.slice(1);
  };
});
</script>